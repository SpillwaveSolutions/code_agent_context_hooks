# CCH Hook Configuration
# =====================
#
# IMPORTANT: This file defines RULES for the CCH policy engine.
# The CCH binary is a POLICY ENGINE that EXECUTES these user-defined rules.
# It does NOT have built-in blocking or injection features.
#
# Without this configuration file, CCH allows all operations.
# All behavior is determined by the rules you define here.
#
# Rule Structure:
#   - name: Unique identifier for the rule
#   - description: Human-readable explanation
#   - matchers: Conditions that trigger the rule (tools, extensions, directories, operations, command_match)
#   - actions: What to do when rule matches (block, inject, run)
#   - metadata: Optional settings like priority, timeout, enabled
#
# For more information, see: docs/RULES.md

version: "1.0"

settings:
  fail_open: true
  script_timeout: 5
  log_level: "info"

rules:
  - name: block-force-push
    description: Block dangerous git force push operations
    matchers:
      tools:
        - Bash
      command_match: "git push.*(--force|-f)"
    actions:
      block: true

  - name: block-hard-reset
    description: Block git hard reset which can destroy work
    matchers:
      tools:
        - Bash
      command_match: "git reset --hard"
    actions:
      block: true

  - name: inject-cdk-skill
    description: Inject CDK skill when editing CDK files
    matchers:
      tools:
        - Edit
        - Write
      directories:
        - "cdk/**"
    actions:
      inject: ".claude/skills/aws-cdk/SKILL.md"

  - name: no-console-log
    description: Block console.log statements in JavaScript/TypeScript files
    matchers:
      tools:
        - Edit
        - Write
      extensions:
        - ".js"
        - ".ts"
        - ".jsx"
        - ".tsx"
    actions:
      run: ".claude/validators/no-console-log.py"

  - name: explain-bash-commands
    description: Require explanation for all Bash commands during permission requests
    matchers:
      tools:
        - Bash
      operations:
        - PermissionRequest
    actions:
      inject: ".claude/context/explain-command.md"
